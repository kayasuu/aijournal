{% extends "base.html" %}

{% block body %}
<div class="container">
    <h1>Edit Entry</h1>

    <form action="/api/entries/edit/{{ entry[0] }}" method="POST" class="entry-form">
        <label for="title">Title:</label>
        <input type="text" name="title" value="{{ entry[2] }}" required><br><br>
        <label for="content">Content:</label><br>
        <textarea name="content" rows="10" cols="30" id="edit_content" required>{{ entry[3] }}</textarea><br><br>

        <div class="buttons-container" id="edit_content_submit">
            <input type="submit" value="Update">
            </form>
            <form action="{{ url_for('analyze_sentiment', entry_id=entry[0]) }}" method="post" id="sentiment-analysis-form">
                <input type="submit" value="AI Feedback">
            </form>
            <form action="/api/entries/delete/{{ entry[0] }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this entry?');">
            <input type="submit" value="Delete">
            </form>
        </div>

        <h2>AI Feedback:</h2>
        <div id="sentiment-result">
            {% for entry in entries %}
            <p>{{ entry[6] }}</p>
            {% endfor %}
        </div>
</div>
<a href="/entries">Back to entries</a>
{% block javascript %}
<script>
    document.getElementById("sentiment-analysis-form").addEventListener("submit", function(event) {
        event.preventDefault();

        fetch(event.target.action, {
            method: "POST"
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById("sentiment-result").innerText = "Sentiment: " + data.sentiment;
        });
    });
</script>
{% endblock %}
{% endblock %}